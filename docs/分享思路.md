
## 解密 Vue2 

> 就讲两件事、宏观上做了什么、微观上怎么做的

* 1: Vue的项目结构
* 2: Vue实例被创建时经历了什么
* 3: 详介<font color="#ff0000">初始化阶段</font>变化侦测过程
* 4: 详介<font color="#ff0000">模板编译阶段</font>

### 一：Vue的项目结构
* 目录结构
    * scripts 与构建相关的脚本和配置文件
    * dist 构建后的文件
    * flow flow的类型声明
    * test 所有的测试代码
    * src 源代码
        * compiler 与模板编译相关的代码
        * core 通用的，与平台无关的运行时代码
            * observer 实现变化侦测相关的代码
            * vdom 实现虚拟DOM的代码
            * instance Vue.js实力的构造函数和原型方法
            * global-api 全局API的代码
            * components 通用的抽象组件
        * server 与服务端渲染相关的代码
        * platforms 特定平台代码
        * sfc 单文件组件（*.vue）解析逻辑
        * shared 整个项目的公用工具代码
    * types TypeScript类型定义
        * test 类型定义测试
* 版本区别
    * 完整版（包含编译器和运行时）
    * 运行时版本
    * 完整版（包含编译器和运行时）（生产环境）
    * 运行时版本（生产环境）  

### 二：Vue实例被创建时经历了什么
* 初始化阶段 [ new Vue() => created() ]
    * initLifecycle() => 初始化实例属性 vm.$parent、vm.$root、vm.$children、vm.$refs...
    * initEvents() => 初始化事件 v-on...
    * initRender() => 初始化渲染函数 vm.$createElement...
    * callHook('beforeCreated') => 生命周期beforeCreated
    * initState() => 初始化状态 props、methods、<font color="#ff0000">data</font>、computed、watch...
    * callHook('created') => 生命周期created
* 模板编译阶段（只存在于完整版）[ create() => beforeMount() ]
    * parser => 解析器 生成AST
    * optimize => 优化器 找出所有静态节点并标记
    * generate => 代码生成器 通过AST生成代码字符串
* 挂载阶段 [ beforeMount() => mount() ]
* <font color="#999">已挂载 [ beforeUpdate() => update() ]</font>
* 卸载阶段 [ beforeDestroy() => destroy() ]
### 三：初始化阶段
* 什么是变化侦测
* 变化侦测的原理
* 具体如何实现 （对象、数组）
* 如何收集依赖
* 依赖收集在哪里
### 四：模板编译阶段
* parser => 解析器 生成AST
    * 解析方式 开始标签开始、开始标签结束、文本、结束标签
    * 推入、推出栈 来维护层级关系（保证每当触发钩子函数start时，栈的最后一个节点就是当前构建的节点的父节点）
* optimize => 优化器 找出所有静态节点并标记
* generate => 代码生成器 通过AST生成渲染函数

### 五：Vue2.x存在的不足
* Vue2.x自身是如何处理和规避的
* Vue3.x是如何改进的 => 时间交给LD